# Role: Legendary Game Architect & Creative Developer
당신은 전력 시스템 전문 지식과 게임 UI/UX 디자인, 그리고 확장성 있는 아키텍처 설계에 능통한 마스터 개발자입니다. 경남 지역 배경의 전력 효율화 RPG인 '에너지그리드(에너지그리드, 이하 에그)'의 웹앱 프로토타입을 React(Vite)로 구현해야 합니다.

# game map은 map.jpg 파일을 참고하세요
# 모르는게 있으면 코드작성을 수행하기전에 중지하게 다시 물어보셔도 됩니다.

# Project Context: '에그(EG)'
- 본 앱은 'kepco-ai-zone'이라는 메인 플랫폼과 분리된 별도의 웹앱입니다.
- 추후 JWT 토큰을 통한 인증과 REST API/Webhook을 통한 EXP(경험치) 및 재화 연동이 예정되어 있습니다.
- 현재는 로컬 데이터를 기반으로 한 연동 테스트 단계이므로, 'Mock API'와 'Local Storage'를 활용한 유연한 구조로 작성하십시오.

# Core Game Logic & UI Requirements
1. [지역 선택 (자유의지)]: 
   - 창원(산업/수요), 진주(기술/혁신), 통영(신재생/풍력), 함안(네트워크/교통) 중 하나를 선택하는 시작 화면을 만드십시오. 각 지역은 고유의 버프(수익 가속, 건설비 할인 등)를 가집니다.
2. [경남 SVG 그리드 맵]: 
   - 경남 지도를 단순화한 SVG 맵을 구현하고, 선택한 지역을 중심으로 거점(노드)을 배치하십시오.
3. [전력 송전 & 업그레이드]:
   - 노드와 노드를 클릭하여 연결하면 '기초 AC 철탑'이 생성됩니다.
   - AC 송전 시 거리에 비례한 전력 손실(붉은 시각 효과)을 시뮬레이션하고, 수익을 차감하십시오.
   - 'HVDC(직류) 변환소'로 업그레이드 시 선로가 네온 블루로 변하며 손실이 0이 되는 '도파민 터지는' 연출을 넣으십시오.
4. [시스템 아키텍처 (통합 대비)]:
   - `useUserStats` 커스텀 훅을 만들어 EXP와 코인 데이터를 관리하십시오. 지금은 로컬에서 작동하지만, 나중에 API 호출로 쉽게 교체할 수 있도록 추상화하십시오.
   - 프로젝트존에서 넘어올 가상의 유저 데이터(JWT Mock) 처리 로직을 포함하십시오.

# Tech Stack
- React, Tailwind CSS, Framer Motion (애니메이션), Lucide React (아이콘)

# Output Expectation
- 한 번에 실행 가능한 완성도 높은 React 코드를 단일 파일 혹은 명확히 구분된 구조로 제공하십시오. 
- 디자인은 사이버펑크와 스마트 시티 느낌이 섞인 세련된 다크 모드 테마를 적용하십시오.
- 사용자에게 "효율화의 쾌감"을 줄 수 있는 인터랙티브한 피드백(파티클, 사운드 팝업 등)을 코드에 녹여내십시오.

"한, 이제 '에그'의 첫 번째 라인을 그려보자. 코드를 생성해줘."

ㅡㅡㅡ
초기 건물지을때 자본금이 필요한데, 맨처음 전력공급에는 발전소,철탑,변전소, 전력케이블,배전지사,전신주,변압기가 필요하잖아? 이건 초기 1셋트는 무료로 주고 이후부터 exp로 코인으로 교환해서 구매하게 할까?
ㅡㅡㅡㅡ

# Role: The Architect of Energy (Designer, Philosopher, Psychologist, & Coder)
당신은 전력 공학의 이성, 게임 디자인의 재미, 마케팅의 감각을 모두 갖춘 마스터 개발자입니다. 프로젝트 '에너지그리드(에너지그리드, 이하 에그)'의 핵심 웹앱을 React(Vite)로 구현하십시오.

# Philosophy & Psychology: '에그'의 세계관
1. [엔트로피와의 전쟁]: 전력 손실(AC)은 무질서와 낭비입니다. 플레이어는 질서(DC)를 통해 경남을 구원하는 '에너지 가디언'입니다.
2. [도파민 루프]: 손실이 발생하면 붉은 연기와 경고음으로 '손실 혐오'를 자극하고, DC 업그레이드 시 네온 블루 효과와 경쾌한 사운드로 '효율의 쾌감'을 폭발시킵니다.
3. [자유의지]: 경남의 각 도시(창원, 진주, 통영, 함안)는 각기 다른 사회적/지리적 가치를 지닌 '클래스'입니다.

# Game Design: 핵심 시스템 (에그 아키텍처)
1. [초기 스타터 팩 (The Genesis Set)]: 
   - 모든 유저에게 첫 번째 송배전 세트(발전소, 철탑, 변전소, 케이블,전신주, 변압기)를 '무료'로 지급하여 성공 경험을 제공합니다.
   - 이후의 추가 건설은 'kepco-ai-zone'에서 연동된 EXP를 코인으로 환전하여 구매해야 합니다.
2. [경제 시스템]: 
   - `EXP_TO_COIN_RATIO`를 설정하여 유저의 활동이 자본으로 치환되는 메커니즘을 구현하십시오.
3. [SVG 인터랙티브 맵]: 
   - 경남 지도를 단순화하여 구현하고, 노드(변전소/발전소)와 엣지(철탑/케이블)를 드래그로 연결하는 직관적인 UX를 제공하십시오.
4. [전력 흐름 로직]:
   - AC Mode: 거리에 따른 저항 및 전력 손실 시뮬레이션. 
   - DC Mode: HVDC/LVDC 업그레이드 시 효율 최적화 시각화.

# Technical Architecture: 'kepco-ai-zone' 연동 대비
1. [Decoupled Architecture]: 메인 플랫폼과 분리된 독립 웹앱으로 설계하십시오.
2. [Mock API Layer]: 추후 DB 및 JWT 연동을 위해 `useEggAuth`, `useEggEconomy` 커스텀 훅을 만들어 데이터 통신 로직을 추상화하십시오.
3. [Local Storage Persistence]: 현재는 로컬DB 상태이므로, 게임 상태를 브라우저에 저장하여 새로고침 시에도 유지되게 하십시오.

# UI/UX Style
- Theme: Cyberpunk Smart City (다크 모드, 네온 블루/옐로우 포인트)
- Interaction: Framer Motion을 활용한 부드러운 전환과 파티클 효과.

"한, 경남의 에너지를 부화시킬 준비가 되었습니다. 코드를 생성하십시오."



ㅡㅡㅡ
게임시작시에는 불꺼진 마을과 산업단지만 존재해야겠네. 초기스타터팩으로 시작하는거야. 이거 맞아?

ㅡㅡㅡ

# Role: The Grid Overlord (Game Architect & System Engineer)
당신은 전력 계통의 논리와 게임 디자인의 예술을 결합한 마스터 개발자입니다. 프로젝트 '에너지그리드(에그)'의 메인 웹앱 프로토타입을 React(Vite)로 구현하십시오.

# Visual & Narrative Concept: "Hatch the Dark Gyeongnam"
# game map은 map.jpg 파일을 참고하세요
1. [배경]: 현대~근미래의 스마트 시티. 다크 모드 기반에 네온 블루/골드 포인트의 사이버펑크 감성.
2. [초기 상태]: 게임 시작 시 경남 지도는 전력이 차단되어 어둡습니다(Blackout). 주요 거점만 희미하게 빛납니다.
3. [온보딩]: 유저는 '스타터팩'을 통해 어두운 도시에 첫 번째 불을 밝히는 '에너지 가디언'의 서사를 시작합니다.

# Game Design: 핵심 시스템 및 UI
1. [스타터팩 (The First Light)]: 
   - 초기 1세트 무료 지급: 발전소, 철탑, 변전소, 전력케이블, 전신주, 변압기.
   - 드래그 앤 드롭 혹은 순차 클릭 방식으로 전력 계통을 완성하게 하십시오.
2. [전력 효율 로직]:
   - AC 송전: 선로 길이에 비례한 손실 시뮬레이션 (붉은 스파크/연기 효과).
   - DC 업그레이드: 변전소를 HVDC로 전환 시 네온 블루 이펙트와 함께 손실 0 구현.
3. [경제 시스템 (API 연동 대비)]:
   - EXP(경험치)를 코인으로 환전하는 UI를 포함하십시오. 
   - 현재는 Local Storage와 Mock Data를 활용해 상태를 유지하십시오.
4. [지역 선택 (자유의지)]:
   - 창원(산업), 진주(혁신), 통영(풍력), 함안(네트워크) 중 선택 시 해당 지역의 특화 버프 적용.

# Technical Stack
- React, Tailwind CSS, Framer Motion (고급 애니메이션 필수), Lucide React (아이콘).
- 모든 데이터 로직은 `useEggEngine`, `useEggUser` 같은 커스텀 훅으로 분리하여 추상화하십시오.

# Interaction Requirement
- 전력이 최종 변압기까지 도달해 마을의 불이 켜질 때, 화면 전체에 화려한 'Grid Reconnected' 파티클 효과를 연출하십시오.

"이제 경남의 어둠을 걷어낼 '에그'의 첫 번째 코드를 작성하십시오."

------
일단 깃허브랑 연동하고 커밋까지 해줘
https://github.com/kai01235813-eng/energy_grid_game

--------

map.jpg 이미지(경남 지도) 위에 전력설비가 설치되야해. 
그래야 사람들이 재밌어해
그래픽이 반영되도록 다시 만들어줘.

------

# Role: The Realist Grid Architect (Senior Front-End Developer & UX Specialist)
당신은 리액트(React) 환경에서 이미지 기반의 인터랙티브 맵을 구현하는 데 최고 전문가입니다. 현재 프로토타입의 추상적인 그리드 배경은 플레이어의 몰입을 방해하고 있습니다. 우리의 목표는 실제 지형 위에 설비를 건설하는 리얼한 경험을 제공하는 것입니다.

# Critical Task: 배경 맵 교체 및 좌표 시스템 재정의
추상적인 배경을 제거하고, 제가 제공하는 실제 경남 지도 이미지를 게임의 메인 캔버스로 사용하도록 코드를 전면 수정하십시오.

# Technical Implementation Guide (React + Tailwind CSS)
1. [이미지 에셋 통합]:
   - 제공된 경남 지도 이미지 파일(예: `energy_grid_game/map_bg.jpg`)을 프로젝트에 임포트하십시오.
2. [메인 게임 컨테이너 수정]:
   - 현재의 그리드 그리기 로직을 완전히 제거하십시오.
   - 메인 게임 영역(`div`)의 스타일을 다음과 같이 설정하여 지도가 배경으로 깔리게 하십시오.
   - `position: relative;` (자식 요소들의 절대 좌표 기준점이 됨)
   - `background-image: url(imported_map_image);`
   - `background-size: cover;` 또는 `contain;` (화면 비율에 맞춰 조정, 맵이 잘리지 않는 것이 중요)
   - `background-position: center;`
   - `width: 100%; height: [적절한 높이 또는 뷰포트 기준];`
3. [설비 및 노드 배치 방식 변경]:
   - 기존의 그리드 좌표계 대신, 이 배경 이미지 위에서의 **절대 좌표(Absolute Position)** 또는 **퍼센트(%) 기반 좌표**를 사용하여 도시 노드, 발전소, 철탑 등을 배치해야 합니다.
   - 예: 창원 노드는 `style={{ position: 'absolute', top: '60%', left: '55%' }}` 와 같이 실제 지도상의 위치에 고정되어야 합니다.
4. [기존 로직 유지]:
   - 스타터팩 지급, 건물 건설, UI 오버레이 등 기존의 게임 로직은 그대로 유지하되, 렌더링되는 바닥판만 실제 이미지로 교체되어야 합니다.

# Output Requirement
- 수정된 `GameMap.jsx` (또는 메인 컴포넌트) 코드를 제공하십시오.
- CSS(Tailwind 클래스)가 배경 이미지와 아이템 배치에 어떻게 적용되었는지 주석으로 명확히 설명하십시오.

"한, 가짜 그리드는 버려라. 이제 플레이어들은 진짜 경남 땅 위에 철탑을 세우게 될 것이다. 코드를 수정하라."

---

경남맵 파일을 못불러오는거같은데 맞지?


---
# Role: Debugging Master & React Architect
지금 'GyeongnamMap.jsx'에서 `TypeError: Cannot read properties of undefined (reading 'find')` 에러가 발생하며 화면이 검은색으로 뜹니다. 이 크래시를 해결하고 지도를 정상화하십시오.

# Critical Fix: 데이터 안전성 확보
1. [Optional Chaining 도입]: 
   - `gameState.nodes.find(...)` 처럼 데이터를 찾는 모든 로직에 `?.`를 붙여서 데이터가 없을 때 앱이 죽지 않게 하십시오. (예: `gameState?.nodes?.find(...)`)
2. [초기값 보장]:
   - `gameState`의 초기 상태(Initial State)에서 `nodes`, `lines`, `demandPoints` 등이 반드시 '빈 배열([])'로 선언되어 있는지 확인하고 수정하십시오.
3. [이미지 경로 및 렌더링 확인]:
   - `public/map.jpg`를 불러오는 부분에서 이미지가 로드되기 전에는 '로딩 중' 화면을 띄우고, 로드된 후에만 맵을 그리도록 로직을 보강하십시오.
4. [Container Height]:
   - 메인 `div`에 `h-screen` 또는 `h-[800px]` 같은 명확한 높이값이 있는지 다시 점검하십시오.

"한, 논리 에러를 수정하고 경남 지도를 즉시 복구하라. 코드를 다시 생성하라."
---

지금 다시 에그게임으로 돌아와서, 지도가 경남지역이 잘 안보이고, 건물을 어떻게 지었는지도 보이지가 않아. 그리고 게임을 테스트하는 용도의 개발자모드가 필요할거같아. 왜냐면 건물 지어진지 확인도 하고 데이터를 다시 삭제하기도 하면서 테스트를 해봐야 하거든. 클로드 프롬프트로 만들어줘


---



그리고 지금 구조물을 지으면 그래픽이 하나도 안보이니까 아이콘으로 지도위에 표시되도록 만들어주고 아이콘은 매우 현실을 반영하면서도 아기자기해야해. 프롬프트 만들어줘

---



